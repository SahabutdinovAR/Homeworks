# Java IO

* Поток (Stream -> Input stream / output stream) - последовательность байт.

* `InputStream` - класс, который описывает работу с входным потоком.

```java
abstract class InputStream {
    // возвращает считанный байт из какого-либо потока (0..255)
    // 1 байт - 8 бит - 2^8 = 256 значений в диапазоне 0...255
    // если считывать нечего - возвращается -1
    public abstract int read() throws IOException;
    // метод считывает байты из потока в массив b, начиная с начала файла до конца массива
    public int read(byte b[]) throws IOException {
        // вызывается другой метод read, который помимо массива (куда нужно считывать) принимает на вход 
        // с какой позиции нужно считывать в массив (в данном случае с нулевой) и до каких пор нужно считывать 
        // (в данном случае, пока не дойдем до конца массива)
        return read(b, 0, b.length);
    }
    
    public int read(byte b[], int off, int len) throws IOException {
            // считали байт из потока
            int c = read();
            // если поток ничего не содержит
            if (c == -1) {
                // возвращаем минус один
                return -1;
            }
            // кидаем первый символ в массив
            b[off] = (byte)c;
    
            int i = 1;
            try {
                for (; i < len ; i++) {
                    // считываем символ
                    c = read();
                    // если он признак конца файла
                    if (c == -1) {
                        // останавливаемся
                        break;
                    } 
                    // если нет - то закидываем в массив с учетом сдвига (off)
                    b[off + i] = (byte)c;
                }
            } catch (IOException ee) {
            }
            return i;
        }


}
```

* Заметим, что в `InputStream` не реализована логика считывания одного байта, то при этом
описан алгоритм, считывающий из потока массив байт. Это сделано потому, что логика считывания байта из потока
может быть для разных типов потока реализована по-разному (например считывание байта из файла или считывание байта с клавиатуры).
А логика считывания массива байт общая для любого потока и основана на считывании одного байта.


* `FileInputStream` - класс, потомок `InputStream`, описывает работу входного потока для файлового потока.

```java
class FileInputStream extends InputStream {
     
    public int read() throws IOException {
        // вызов нативного метода
         return read0();
     }
     // нативный метод (реализован внутри JVM) для чтения байтов из файла
     private native int read0() throws IOException;
}
```

* Вопрос из собеседования:

```
Почему 

public int read() возвращает int, хотя мы считываем байт и его затем приходится конвертировать в byte

но при этом

public int read(byte[] b) умеет считывать в МАССИВ БАЙТОВ

Чтобы вернуть -1

В java byte имеет диапазон -128 ... 127 (в java все типы идут со знаком)
Следовательно, если бы метод read возвращал byte, 
то была бы неоднозначность - либо вернулось -1 потому что кончился поток
либо вернулось -1 потому что мы прочитали байт 255

В тех местах, где нам уже не важно, -1 там или нет - работаем с byte
```

* `Reader/Writer` - предназначены для работы с потоком символов, удобно для работы с текстовыми файлами.

* `Buffered` 
    - `Reader`
    - `Writer`
    - `InputStream`
    - `OutputStream`
    
Глобально не отличаются от стандартных IO-классов, единственное, это наличие встроенных механизмов буферизации
для ускорения работы, следовательно, использование Buffered предпочтительно.